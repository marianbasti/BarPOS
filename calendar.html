<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <style media="screen">
      #reservationsList {overflow-y: scroll;position: absolute;width:60%;height:100% top:0px; right:0px;margin: 80px}
      table, td, th, tr{height:10%; color: white;border: 1px solid white; border-collapse: collapse}
    </style>
    <title></title>
  </head>
  <body>
    <table id='reservationsList'>
      <tr>
        <td>Nombre</td>
        <td>Cantidad</td>
        <td>Dia</td>
        <td>Horario</td>
        <td>Mesa</td>
      </tr>
    </table>
  </body>
  <script type="text/javascript">
  $.getJSON("/tables.json", function(response) {
    for (var i = 0; i<tables.length; i++) {
      var reservation = response[i].reservations;
      if(reservation.length == 0) {
      } else {
        for (var j = 0; j<reservation.length; j++) {
          console.log(reservation);
          var resDate = reservation[j].date.split('T')[0];
          var resHour = reservation[j].date.split('T')[1];
          var markup = "<tr id='" + i + "r"+j+"'><td>" + reservation[j].client + "</td><td>" + reservation[j].partyOf + "</td><td>" + resDate + "</td><td>" + resHour + "</td><td>" + Number(i+1) + "</td><td> <input class='removeReservation' type='button' value='Eliminar'></td></tr>";
          $("#reservationsList tr:last").after(markup);
        }
      }
    }
    $('#reservationsList').on('click', function(e) {
        e.stopPropagation();
    });
    $('#reservationsList').on('click', '.removeReservation', function() {
      var table = Number($(this).closest('tr').attr('id').split('r')[0])+1;
      var reservationNo = $(this).closest('tr').attr('id').split('r')[1];
      tables[table-1].reservations.splice(reservationNo, 1);
      console.log(tables[table-1].reservations);
      $(this).closest('tr').remove();
      if (reservationNo == 0) {
        tables[table-1].isReserved = false;
      }
      socket.emit('removeReservation', [tables, table]);
    })
  });
  </script>
</html>
